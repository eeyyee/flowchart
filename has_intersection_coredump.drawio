<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.3.2">
  <diagram name="第 1 页" id="TGFJZgri0NZczpJ4mUPl">
    <mxGraphModel dx="2893" dy="1103" grid="1" gridSize="11" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-7" edge="1" parent="1" source="-0VXKY3Mc9BWSKFJ0WNE-1" style="rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontFamily=Comic Sans MS;" target="-0VXKY3Mc9BWSKFJ0WNE-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-8" edge="1" parent="1" source="-0VXKY3Mc9BWSKFJ0WNE-1" style="rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontFamily=Comic Sans MS;" target="-0VXKY3Mc9BWSKFJ0WNE-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-9" edge="1" parent="1" source="-0VXKY3Mc9BWSKFJ0WNE-1" style="rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontFamily=Comic Sans MS;" target="-0VXKY3Mc9BWSKFJ0WNE-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-1" parent="1" style="ellipse;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Comic Sans MS;" value="Old Impalad" vertex="1">
          <mxGeometry height="80" width="120" x="354" y="350" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-7" edge="1" parent="1" source="-0VXKY3Mc9BWSKFJ0WNE-2" style="rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;" target="mkD70oeof6QpfOQpk2mG-6" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-2" parent="1" style="ellipse;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Comic Sans MS;" value="New&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;Impalad&lt;/span&gt;" vertex="1">
          <mxGeometry height="80" width="120" x="150" y="545" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-5" parent="1" style="ellipse;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Comic Sans MS;" value="New Impalad" vertex="1">
          <mxGeometry height="80" width="120" x="354" y="550" as="geometry" />
        </mxCell>
        <mxCell id="-0VXKY3Mc9BWSKFJ0WNE-6" parent="1" style="ellipse;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Comic Sans MS;" value="Old Impalad" vertex="1">
          <mxGeometry height="80" width="120" x="560" y="550" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-1" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontFamily=Comic Sans MS;" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;b&gt;coordinator&lt;/b&gt;：&lt;br&gt;执行前对 fragments 执行 open，此时scope 为 fragment local；由于&lt;/font&gt;&lt;span style=&quot;font-size: 13px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;没有 has_intersection 优化相关代码，不会进行 prepare，func_ctx 没有设置 hi_state&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;hi_state = nullptr&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="156" width="237" x="495" y="319" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-2" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontFamily=Comic Sans MS;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;backend executor (Old):&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;原有逻辑，略&lt;/div&gt;" vertex="1">
          <mxGeometry height="57" width="176" x="704" y="570" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-3" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontFamily=Comic Sans MS;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;backend executor（new）:&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Comic Sans MS&quot; style=&quot;&quot;&gt;作为 backend executor，执行前也会open，且 func_ctx 中会把 coordinator 的 fragment local ctx 复制过来，不过对于此情况，coordinator 没有设置，fragment local state 为NULL；&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;且原本逻辑中，prepare 只处理 fragment local 的情况，所以对于 backend executor 的 open 会直接忽略，hi_state 还是没有设置&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;hi_state = nullptr&lt;/font&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="142.5" width="264" x="-143" y="561.5" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-4" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontFamily=Comic Sans MS;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;backend executor（new）:&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;略&lt;/div&gt;" vertex="1">
          <mxGeometry height="57" width="176" x="330" y="647" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-6" parent="1" style="whiteSpace=wrap;html=1;fontFamily=Comic Sans MS;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;" value="has_intersection execution" vertex="1">
          <mxGeometry height="60" width="169" x="125.5" y="770" as="geometry" />
        </mxCell>
        <mxCell id="mkD70oeof6QpfOQpk2mG-8" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontFamily=Comic Sans MS;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;backend executor（new）:&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;实际执行时会取出&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;hi_state&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;进行判断，但是此时 hi_state 为 nullptr，出现空指针访问，导致 coredump&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="57" width="220" x="-77" y="858" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
